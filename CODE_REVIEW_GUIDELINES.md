# ChoreCoin コードレビューガイドライン

## コードレビューの目的
- コード品質の向上
- バグの早期発見
- 知識の共有
- アーキテクチャの一貫性維持
- セキュリティ脆弱性の防止

## レビュー観点

### 1. コード品質

#### 可読性
- [ ] 変数名、関数名は意味が明確か
- [ ] コメントは必要十分か（過剰でも不足でもない）
- [ ] マジックナンバーは定数化されているか
- [ ] ネストが深すぎないか（3階層まで）
- [ ] 関数は単一責任の原則に従っているか

#### 保守性
- [ ] DRY原則（Don't Repeat Yourself）が守られているか
- [ ] 関数のサイズは適切か（50行以内推奨）
- [ ] モジュール化は適切か
- [ ] 疎結合になっているか
- [ ] テストしやすい構造か

#### パフォーマンス
- [ ] 不要なループや再レンダリングがないか
- [ ] データベースクエリは最適化されているか
- [ ] N+1クエリ問題がないか
- [ ] メモリリークの可能性がないか
- [ ] 非同期処理が適切に使われているか

### 2. セキュリティ

#### 認証・認可
- [ ] 適切な認証チェックが行われているか
- [ ] 権限確認が正しく実装されているか
- [ ] セッション管理は適切か
- [ ] パスワードは暗号化されているか

#### データ検証
- [ ] ユーザー入力は検証されているか
- [ ] SQLインジェクション対策がされているか
- [ ] XSS対策がされているか
- [ ] CSRF保護が実装されているか

#### 機密情報
- [ ] APIキーやパスワードがハードコードされていないか
- [ ] ログに機密情報が出力されていないか
- [ ] 環境変数が適切に使用されているか

### 3. テスト

#### テストカバレッジ
- [ ] 新しいコードにテストが書かれているか
- [ ] エッジケースがテストされているか
- [ ] 既存のテストが壊れていないか

#### テスト品質
- [ ] テストは独立して実行できるか
- [ ] テストは読みやすいか
- [ ] モックは適切に使用されているか
- [ ] テストの命名は明確か

### 4. エラーハンドリング

- [ ] エラーケースが適切に処理されているか
- [ ] エラーメッセージは分かりやすいか
- [ ] エラーログは適切に記録されているか
- [ ] ユーザーフレンドリーなエラー表示か

### 5. API設計

- [ ] RESTful原則に従っているか
- [ ] HTTPステータスコードは適切か
- [ ] レスポンス形式は一貫しているか
- [ ] バージョニングが考慮されているか
- [ ] ドキュメントが更新されているか

### 6. データベース

- [ ] マイグレーションファイルが含まれているか
- [ ] インデックスは適切に設定されているか
- [ ] トランザクション処理は適切か
- [ ] データの整合性が保たれているか

### 7. フロントエンド固有

#### React/Vue
- [ ] コンポーネントは再利用可能か
- [ ] Propsの型定義は適切か
- [ ] 不要な再レンダリングがないか
- [ ] useEffect/watchの依存配列は正しいか
- [ ] メモ化は適切に使用されているか

#### スタイリング
- [ ] CSSクラス名は意味的か
- [ ] レスポンシブデザインに対応しているか
- [ ] アクセシビリティが考慮されているか

### 8. モバイル固有

#### iOS
- [ ] Auto Layoutは適切か
- [ ] メモリ管理は適切か（ARCの活用）
- [ ] バックグラウンド動作は考慮されているか

#### Android
- [ ] ライフサイクルメソッドは適切か
- [ ] リソースの解放が行われているか
- [ ] 画面サイズの違いに対応しているか

## レビュープロセス

### レビュアーの責務

1. **タイムリーなレビュー**
   - 24時間以内にレビューを開始
   - 小さなPRは優先的に

2. **建設的なフィードバック**
   - 具体的な改善案を提示
   - 批判的ではなく協力的に
   - 良い点も指摘する

3. **レビューコメントの分類**
   - 🔴 **必須**: セキュリティ、バグ、重大な問題
   - 🟡 **推奨**: ベストプラクティス、パフォーマンス改善
   - 🟢 **提案**: スタイル、微細な改善、質問

### 作成者の責務

1. **PR作成時**
   - 明確なタイトルと説明
   - 関連するIssueへのリンク
   - スクリーンショット（UI変更時）
   - 自己レビューを実施

2. **レビュー後**
   - 全てのコメントに返信
   - 変更を加えた場合は説明
   - 議論が必要な場合は会話を開始

## コードレビューチェックリスト

### PR作成前
- [ ] コードをセルフレビューした
- [ ] テストをローカルで実行し、全て成功した
- [ ] リンターエラーがない
- [ ] ビルドが成功する
- [ ] ブランチは最新のmainから作成されている
- [ ] コミットメッセージは明確

### レビュー時
- [ ] コードの意図を理解した
- [ ] セキュリティリスクがない
- [ ] パフォーマンスへの悪影響がない
- [ ] テストが適切
- [ ] ドキュメントが更新されている
- [ ] 破壊的変更がない（または適切に文書化されている）

## ベストプラクティス

### DO（推奨）
✅ 小さなPRを作成（200-400行まで）
✅ 単一の機能や修正に集中
✅ 説明的なコミットメッセージ
✅ テストを含める
✅ ドキュメントを更新
✅ コードフォーマッターを使用
✅ 型安全性を重視

### DON'T（非推奨）
❌ 無関係な変更を混ぜる
❌ フォーマット変更だけの大規模PR
❌ テストなしでロジック変更
❌ コメントなしの複雑なコード
❌ console.logやデバッグコードを残す
❌ TODOコメントを放置（Issueを作成）

## レビューコメント例

### 良い例
```
🔴 セキュリティ: ユーザー入力が検証されていません。
バリデーションを追加することを推奨します。

例:
if (!validator.isEmail(email)) {
  throw new ValidationError('Invalid email');
}
```

```
🟡 パフォーマンス: このループはO(n²)の計算量です。
Map/Setを使用して最適化できます。
```

```
🟢 スタイル: 関数名をより説明的にできます。
`process()` → `processChoreCompletion()`
```

### 悪い例
```
❌ これは間違っています。修正してください。
（何が間違っているか不明確）

❌ こんなコード書かないでください。
（批判的で建設的でない）

❌ 直して。
（具体性がない）
```

## 自動化ツール

### リンター
- **ESLint**: JavaScript/TypeScript
- **Pylint/Flake8**: Python
- **SwiftLint**: Swift
- **ktlint**: Kotlin

### フォーマッター
- **Prettier**: JavaScript/TypeScript
- **Black**: Python
- **SwiftFormat**: Swift

### 静的解析
- **SonarQube**: コード品質分析
- **CodeQL**: セキュリティ脆弱性検出
- **TypeScript**: 型チェック

### CI/CD統合
- GitHub Actionsで自動実行
- PRマージ前に必須チェック
- カバレッジレポート自動生成

## まとめ

コードレビューは、品質向上だけでなく、チームの学習とコミュニケーションの場です。
お互いに敬意を持ち、建設的なフィードバックを心がけましょう。
